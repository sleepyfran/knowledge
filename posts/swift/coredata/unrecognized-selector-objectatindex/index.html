<!doctype html><html lang=en><head><title>Unrecognized selector `objectAtIndex` :: sleepyfran's blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Unrecognized selector objectAtIndex 2022-06-21 22:41:30.447763+0200 App[56115:1179524] -[__NSCFSet objectAtIndex:]: unrecognized selector sent to instance 0x600003df9c20 This happened with the following code, basically when trying to do a ForEach on a property coming from a CoreData model:
import CoreData import SwiftUI struct BudgetView: View { @FetchRequest(entity: CategoryGroup.entity(), sortDescriptors: []) var categoryGroups: FetchedResults&amp;lt;CategoryGroup&amp;gt; var body: some View { VStack { List { ForEach(categoryGroups, id: \.id) { group in Text(group.name) ForEach(group.categories, id: \.id) { category in Text(category."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://sleepyfran.github.io/blog/posts/swift/coredata/unrecognized-selector-objectatindex/><link rel=stylesheet href=https://sleepyfran.github.io/blog/assets/style.css><link rel=stylesheet href=https://sleepyfran.github.io/blog/assets/ruber.css><link rel=apple-touch-icon href=https://sleepyfran.github.io/blog/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://sleepyfran.github.io/blog/img/favicon/ruber.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Unrecognized selector `objectAtIndex`"><meta property="og:description" content="Unrecognized selector objectAtIndex 2022-06-21 22:41:30.447763+0200 App[56115:1179524] -[__NSCFSet objectAtIndex:]: unrecognized selector sent to instance 0x600003df9c20 This happened with the following code, basically when trying to do a ForEach on a property coming from a CoreData model:
import CoreData import SwiftUI struct BudgetView: View { @FetchRequest(entity: CategoryGroup.entity(), sortDescriptors: []) var categoryGroups: FetchedResults&amp;lt;CategoryGroup&amp;gt; var body: some View { VStack { List { ForEach(categoryGroups, id: \.id) { group in Text(group.name) ForEach(group.categories, id: \.id) { category in Text(category."><meta property="og:url" content="https://sleepyfran.github.io/blog/posts/swift/coredata/unrecognized-selector-objectatindex/"><meta property="og:site_name" content="sleepyfran's blog"><meta property="og:image" content="https://sleepyfran.github.io/blog"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2022-06-21 11:43:39 +0200 +0200"></head><body class=ruber><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://sleepyfran.github.io/blog><div class=logo>sleepyfran's blog</div></a></div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://sleepyfran.github.io/blog/posts/swift/coredata/unrecognized-selector-objectatindex/>Unrecognized selector <code>objectAtIndex</code></a></h1><div class=post-meta><span class=post-date>2022-06-21</span>
<span class=post-author>:: sleepyfran</span></div><span class=post-tags>#<a href=https://sleepyfran.github.io/blog/tags/coredata/>coredata</a>&nbsp;
#<a href=https://sleepyfran.github.io/blog/tags/swiftui/>swiftui</a>&nbsp;
#<a href=https://sleepyfran.github.io/blog/tags/swift/>swift</a>&nbsp;
#<a href=https://sleepyfran.github.io/blog/tags/gotchas/>gotchas</a>&nbsp;</span><div class=post-content><div><h1 id=unrecognized-selector-objectatindex>Unrecognized selector <code>objectAtIndex</code><a href=#unrecognized-selector-objectatindex class=hanchor arialabel=Anchor>&#8983;</a></h1><pre tabindex=0><code>2022-06-21 22:41:30.447763+0200 App[56115:1179524] -[__NSCFSet objectAtIndex:]: unrecognized selector sent to instance 0x600003df9c20
</code></pre><p>This happened with the following code, basically when trying to do a <code>ForEach</code> on a property coming from a CoreData model:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>CoreData</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BudgetView</span>: View {
</span></span><span style=display:flex><span>    @FetchRequest(entity: CategoryGroup.entity(), sortDescriptors: [])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> categoryGroups: FetchedResults&lt;CategoryGroup&gt;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            List {
</span></span><span style=display:flex><span>                ForEach(categoryGroups, id: <span style=color:#960050;background-color:#1e0010>\</span>.id) { group <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    Text(group.name)
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    ForEach(group.categories, id: <span style=color:#960050;background-color:#1e0010>\</span>.id) { category <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                        Text(category.name)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This property is actually declared manually as an array:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CategoryGroup</span>: NSManagedObject, Identifiable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@NSManaged</span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>var</span> categories: [Category]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But even though <em>I</em> declared it as an array apparently the underlying type that CoreData actually puts there is an <code>NSSet</code>, which by default does not allow to retrieve stuff by its index (does that unrecognized selector <code>objectAtIndex</code> makes a bit more sense now?)</p><p>The easy solution is to mark the property as &ldquo;Ordered&rdquo; in the CoreData model. The <strong>proper</strong> solution, however, is to not interact with <code>NSSet</code> directly unless we can avoid it, so we can simply introduce a computed variable that transforms our property into an array (or whatever other data type we need!):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>var</span> categoriesArray: [Category] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> set = categories <span style=color:#66d9ef>as</span>? Set&lt;Category&gt; ?? []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>set</span>.sorted {
</span></span><span style=display:flex><span>        $0.id <span style=color:#f92672>&lt;</span> $1.id
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This casts the <code>NSSet</code> into an array sorting it by their ID. Now instead of doing the <code>ForEach</code> directly on the <code>categories</code> property we have to use this computed one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>CoreData</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BudgetView</span>: View {
</span></span><span style=display:flex><span>    @FetchRequest(entity: CategoryGroup.entity(), sortDescriptors: [])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> categoryGroups: FetchedResults&lt;CategoryGroup&gt;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            List {
</span></span><span style=display:flex><span>                ForEach(categoryGroups, id: <span style=color:#960050;background-color:#1e0010>\</span>.id) { group <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    Text(group.name)
</span></span><span style=display:flex><span>                    
</span></span><span style=display:flex><span>                    <span style=color:#75715e>/* The change is here */</span>
</span></span><span style=display:flex><span>                    ForEach(group.categoriesArray, id: <span style=color:#960050;background-color:#1e0010>\</span>.id) { category <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                        Text(category.name)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://sleepyfran.github.io/blog/posts/swift/coredata/swiftui-grouped-queries/><span class=button__icon>←</span>
<span class=button__text>Grouped queries in SwiftUI</span></a></span>
<span class="button next"><a href=https://sleepyfran.github.io/blog/posts/hello-world/><span class=button__text>Hello world!</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme based on <a href=https://github.com/panr/hugo-theme-terminal>Terminal</a></span>
<span>:: Code available on <a href=https://github.com/sleepyfran/blog>GitHub</a></span></div></div></footer><script src=https://sleepyfran.github.io/blog/assets/main.js></script>
<script src=https://sleepyfran.github.io/blog/assets/prism.js></script></div></body></html>